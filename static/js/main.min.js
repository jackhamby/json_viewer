let g_json=null;class Tree{constructor(e,t){this.json=t,this.dom_id=e,this.nodes=this.create_nodes(t)}create_nodes(e){let t=[];if(Array.isArray(e))for(let n in e)t.push(Node.create_node(n,e[n],null,!1,!0));else if("object"==typeof e)for(let n in e)t.push(Node.create_node(n,e[n],null,!1,!1));return t}to_jstree(){let e=this;return{core:{data:[{id:"root",text:"json",children:this.nodes.map(e=>e.to_jstree()),type:Array.isArray(this.json)?"array":"object"}],check_callback:!0},types:{object:{icon:"../static/images/object.gif"},array:{icon:"../static/images/array.gif"},int:{icon:"../static/images/int.png"},bool:{icon:"../static/images/bool.png"},null:{icon:"../static/images/null.png"},string:{icon:"../static/images/string.png"}},contextmenu:{items:function(t){return e.create_context_menu(t)}},plugins:["types","contextmenu"]}}create_context_menu(e){let t=this.get_node(e.id);return console.log(t),t?null===t.parent||t.parent instanceof ArrayNode?{copy:{label:"copy",action:function(e){copy_to_clipboard(t.value)}}}:{copy_key:{label:"copy key",action:function(e){copy_to_clipboard(t.key)}},copy_value:{label:"copy value",action:function(e){copy_to_clipboard(t.value)}},copy_key_and_value:{label:"copy key and value",action:function(e){copy_to_clipboard(`${JSON.stringify(t.key)} : ${JSON.stringify(t.value)}`)}}}:{copy:{label:"copy",action:function(e){copy_to_clipboard(g_json)}}}}render(){$(`#${this.dom_id}`).jstree("destroy"),$(`#${this.dom_id}`).jstree(this.to_jstree())}get_node(e){let t=e.split(".");for(let e in this.nodes){let n=this.nodes[e];if(n.path==t[0])return t.splice(0,1),0==t.length?n:n.get_child(t,1)}return null}handle(){let e=this;$(`#${this.dom_id}`).on("select_node.jstree",function(t,n){let o=e.get_node(n.node.id);o?o.children.length>0?render_json_detail(o.value):o.parent?render_json_detail(o.parent.value):render_json_detail(g_json):render_json_detail(g_json)})}}class Node{constructor(e,t,n,o){this.key=e,this.value=t,this.children=[],this.path=n,this.parent=o}to_json(){}to_jstree(){}get_children(e,t=!1){let n=[];for(let o in this.value)n.push(Node.create_node(o,this.value[o],this,e,t));return n}get_child(e,t){for(let n in this.children){let o=this.children[n];if(o.path.split(".")[t]==e[0])return e.splice(0,1),0==e.length?o:o.get_child(e,t+1)}}static create_node(e,t,n,o,r){let i,a=r?`[${e}]`:e;return i=Array.isArray(t)?new ArrayNode(e,t,o=o?`${o}.${a}`:a,n):"object"==typeof t&&null!==t?new ObjectNode(e,t,o=o?`${o}.${a}`:a,n):new LeafNode(e,t,o=o?`${o}.${a}`:a,n)}}class ArrayNode extends Node{constructor(e,t,n,o){super(e,t,n,o),this.children=this.get_children(n,!0)}to_jstree(){return{text:this.key,type:"array",id:this.path,children:this.children.map(e=>e.to_jstree())}}}class ObjectNode extends Node{constructor(e,t,n,o){super(e,t,n,o),this.children=this.get_children(n,!1)}to_jstree(){return{text:this.key,type:"object",id:this.path,children:this.children.map(e=>e.to_jstree())}}}class LeafNode extends Node{constructor(e,t,n,o){super(e,t,n,o)}to_jstree(){return{text:`${this.key} : ${this.value}`,type:this.get_type(),id:this.path}}get_type(){switch(typeof this.value){case"string":return"string";case"boolean":return"bool";case"number":return"int";case"object":return"null";default:return"string"}}}render_json_detail=function(e){$("#detail-container").empty();let t=$("<table class='table'></table>");for(let n in e){let o=e[n];Array.isArray(e[n])?o="...":"object"==typeof e[n]&&(o="...");let r=$(`<tr>\n                         <td>${n}</td>\n                         <td>${o}</td>\n                       </tr>`);t.append(r)}$("#detail-container").append(t)},copy_to_clipboard=function(e){let t=$('<textarea id="copy-text-container" class="copy-text-area" ></textarea>');$("body").append(t),"object"==typeof e&&(e=JSON.stringify(e)),$("#copy-text-container").val(e),$("#copy-text-container").text(e),$("#copy-text-container").select(),document.execCommand("copy"),$("#copy-text-container").remove()},parse_json=function(e){let t;try{t=JSON.parse(e)}catch{return window.alert("invalid json variable!"),$("#text").click(),!1}return t},$("#format").on("click",function(e){if($("#text").hasClass("active")){let e=$("textarea").val();if(parse_json(e)){let t=JSON.stringify(JSON.parse(e),null,4);$("textarea").val(t)}}}),$("textarea").on("click",function(e){"copy your json here!"==e.target.value&&$(e.target).text("")}),$(".nav-link").on("click",function(e){$(".nav-link").removeClass("active"),$(this).hasClass("active")||$(this).addClass("active")}),$("#text").on("click",function(e){$("#jsondump").show(),$("#tree").hide()}),$("#viewer").on("click",function(e){let t;$("#jsondump").hide(),$("#tree").show();let n=$("textarea").val();if(t=parse_json(n)){g_json=t;let e=new Tree("tree",t);e.render(),e.handle()}});