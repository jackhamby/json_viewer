<!DOCTYPE html>
<html>
    <head>
        <title>json viewer</title>
    </head>
    <body>
        <div class="container-fluid">
            <!-- Header -->
            <div class="row" style="height: 10%">
                <div class="col-sm" style="margin-top: 10px;" >
                    <ul class="nav nav-tabs">
                        <li class="nav-item">
                            <a class="nav-link" id="viewer" >viewer</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" id="text" >text</a>
                        </li>
                    </ul>     
                </div>
            </div>

            <!-- Main Content -->
            <div class="row" style="height: 90%">
                <!-- Json text area -->
                <div class="col-9" >
                    <textarea class="j-text-area" id="jsondump">copy your json here!</textarea>
                    <div class="tree-container" id="tree" style="display: none;"></div>
                </div>
                <!-- Json detail side bar -->
                <div class="col-3">
                    <table class="table">
                        <tr> 
                            <td> Key</td>
                            <td> Value </td>
                        </tr>
                        <tr>
                            <td>Key</td>
                            <td>Value</td>
                        </tr>


                    </table>
                    <!-- <ul class="list-group" style="width: 50%; float: right;">
                            <li class="list-group-item">key</li>
                            <li class="list-group-item">key</li>
                            <li class="list-group-item">key</li>
                            <li class="list-group-item">key</li>
                            <li class="list-group-item">key</li>
                    </ul>
                    <ul class="list-group" style="width: 50%; float: left">
                            <li class="list-group-item">value</li>
                            <li class="list-group-item">value</li>
                            <li class="list-group-item">value</li>
                            <li class="list-group-item">value</li>
                            <li class="list-group-item">value</li>
                    </ul> -->
                </div>


            </div>
        </div>

    </body>
</html>
<script src="https://code.jquery.com/jquery-3.4.0.js" integrity="sha256-DYZMCC8HTC+QDr5QNaIcfR7VSPtcISykd+6eSmBW5qo=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.8/jstree.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
<script type="text/javascript">




    class Tree {
        constructor(dom_id, json){
            this.json = json;
            this.dom_id = dom_id;
            this.nodes = this.create_nodes(json);
        }

        create_nodes(json){
            let nodes = []
            if (Array.isArray(json)){
                for (let i in json){
                    nodes.push(Node.create_node(i, json[i]))
                }
            }
            else if(typeof(json) == "object"){
                for (let key in json) {
                    nodes.push(Node.create_node(key, json[key]))
                }
            }
            return nodes
        }

        to_jstree(){
            let tree_data = {
                "core" : {
                    "data": [
                        {
                            "id" : "root",
                            "text": "JSON",
                            "children" : this.nodes.map(node => node.to_jstree()),
                            "type" : Array.isArray(this.json) ? "array" : "object"
                        }
                    ]
                },
                "types" : {
                    "object" : {
                        "icon" : "../static/images/object.gif"
                    },
                    "array" : {
                        "icon" : "../static/images/array.gif"

                    }, 
                    "leaf" : {
                        "icon" : false
                    }
                },
                "plugins" : ["types"]
            }
            return tree_data
        }

        render(){
            $(`#${this.dom_id}`).jstree('destroy');
            $(`#${this.dom_id}`).jstree(this.to_jstree());
        }

    }


    class Node {
        constructor(key, value){
            this.key = key;
            this.value = value;
            this.children = [];
        }

        to_json(){
            // override this
        }

        to_jstree() {
            // override this
        }

        get_children(){
            let children = [];
            for (let i in this.value){
                children.push(Node.create_node(i, this.value[i]));
            }
            return children;
        }

        static create_node(key, value){
            let node;
            if (Array.isArray(value)){
                node = new ArrayNode(key, value);
            }
            else if (typeof(value) == "object"){
                node = new ObjectNode(key, value);
            }
            else{
                node = new LeafNode(key, value);
            }
            return node;
        }

    }



    class ArrayNode extends Node {

        constructor(key, value){
            super(key, value);
            this.children = this.get_children();
            
        }

        to_jstree(){
            let jstree_node = {
                "text" : this.key,
                "type" : "array",
                "children" : this.children.map(child => child.to_jstree())
            }
            return jstree_node;
        }
    }

    class ObjectNode extends Node {
        constructor(key, value){
            super(key, value);
            this.children = this.get_children();
        }

        to_jstree(){
            let jstree_node = {
                "text" : this.key,
                "type" : "object",
                "children" : this.children.map(child => child.to_jstree())
            }
            return jstree_node;
        }
    }

    class LeafNode extends Node {
        constructor(key, value){
            super(key, value);
        }

        to_jstree(){
            let jstree_node = {
                "text" : `${this.key} : ${this.value}`,
                "type" : "leaf"
            }
            return jstree_node;
        }
    }

    parse_json = function(json_string){
        let json;
        try {
            json = JSON.parse(json_string);
        }
        catch {
            window.alert("invalid json variable!");
            $('#text').click();
            return false;
        }
        return json;
    }


    $('textarea').on('click', function(event){
        if (event.target.value == "copy your json here!"){
            $(event.target).text("");
        }
    })

    $('.nav-link').on('click', function(event){
        $('.nav-link').removeClass("active");
        if (!$(this).hasClass("active")){
            $(this).addClass("active");
        }
    })

    $('#text').on('click', function(event){
        $('#jsondump').show();
        $('#tree').hide();
    })

    $('#viewer').on('click', function(event){
        let json;
        $('#jsondump').hide();
        $('#tree').show();
        let json_string = $('textarea').val();
        json = parse_json(json_string);
        if (json){
            let tree = new Tree('tree', json);
            tree.render();
            console.log(tree.to_jstree())
        }

    })


    


</script>

<style>

    .list-group-item {
        padding: 5px;
    }

    body {
        height: 100%;
    }

    html {
        height: 100%;
    }

    .container-fluid {
        height: 100%;
    }

    .nav-item {
        font-size: 10px;
        /* padding: 4px; */
    }

    .nav-link {
        padding: 6px;
    }
    
    .nav-link.acive {
        padding: 4px;
    }

    .j-text-area {
        width: 100%;
        height: 100%;
        resize: none;
        color: grey;
    }

    .tree-container {
        margin-top: 20px;
    }

    .table {
        font-size: 10px;
    }

    .table td {
        padding: .25rem;
    }

    .jstree-anchor {
        font-size: 10px;
        /* max-height: 12px; */
    }


    .jstree-default .jstree-node {
        /* max-height: 20px !important; */
        /* min-height: 20px; */
    }


</style>